<%
left = exam.left.first
right = exam.right.first
injuries = left.examination.injuries if left.present?
injuries = right.examination.injuries if left.blank? && right.present?

weight_phrases = []
weight_phrases.push("左#{left.weight}g") if left.try(:weight).present?
weight_phrases.push("左#{right.weight}g") if right.try(:weight).present?
%>
<%= weight_phrases.to_sentence_with_comma_and_full_stop %>

<%
all_symetric = left.try(:air_content) == right.try(:air_content) &&
               left.try(:congestion) == right.try(:congestion)
next_phrases = []
if all_symetric
  if left.try(:air_content).present?
    next_phrases.push("含気量#{I18n.t "mass_quantity.#{left.air_content}"}")
  end
  if left.try(:congestion).present?
    next_phrases.push("鬱血#{I18n.t "intensity.#{left.congestion}"}")
  end
else
  air_content_phrases = []
  air_content_symetric = left.try(:air_content) == right.try(:air_content)
  if air_content_symetric
    air_content_phrases.push("左右#{I18n.t "mass_quantity.#{left.air_content}"}") if left.try(:air_content).present?
  else
    air_content_phrases.push("左#{I18n.t "mass_quantity.#{left.air_content}"}") if left.try(:air_content).present?
    air_content_phrases.push("右#{I18n.t "mass_quantity.#{right.air_content}"}") if right.try(:air_content).present?
  end
  next_phrases.push("含気量#{air_content_phrases.to_sentence_with_comma}") if air_content_phrases.any?

  congestion_phrases = []
  congestion_symetric = left.try(:congestion) == right.try(:congestion)
  if congestion_symetric
    congestion_phrases.push("左右#{I18n.t "intensity.#{left.congestion}"}") if left.try(:congestion).present?
  else
    congestion_phrases.push("左#{I18n.t "intensity.#{left.congestion}"}") if left.try(:congestion).present?
    congestion_phrases.push("右#{I18n.t "intensity.#{right.congestion}"}") if right.try(:congestion).present?
  end
  next_phrases.push("鬱血#{congestion_phrases.to_sentence_with_comma}") if congestion_phrases.any?
end
%>
<%= next_phrases.to_sentence_with_comma_and_full_stop %>

<% if injuries.none? %>
気腫・結節・瘢痕等の異常なし。
<% end %>

<% if right.present? && left.present? && right.foreign_fluids.none? && left.foreign_fluids.none? %>
  左右気管支内に異液なし。
<% else %>
  <% if left.present? %>
    <% if left.foreign_fluids.any? %>
      左気管支内に次の異液がある：<%= ForeignFluid.explanation_of_array(left.foreign_fluids) %>。
    <% else %>
      左気管支内に異液なし。
    <% end %>
  <% end %>
  <% if right.present? %>
    <% if right.foreign_fluids.any? %>
      右気管支内に次の異液がある：<%= ForeignFluid.explanation_of_array(right.foreign_fluids) %>。
    <% else %>
      右気管支内に異液なし。
    <% end %>
  <% end %>
<% end %>

<% if injuries.none? %>
肺門部リンパ節に異常なし。
<% end %>
